<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>KeshavCare ‚Äì V53 OPD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        :root {
            --brand-main: #0f766e;
            --brand-dark: #115e59;
            --brand-main-dark: #115e59;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: radial-gradient(circle at top, #e0f2fe, #f9fafb, #e5e7eb);
            display: flex;
            justify-content: center;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        .app {
            max-width: 980px;
            width: 100%;
            margin: 14px;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 18px 40px rgba(15, 23, 42, .14);
            padding: 18px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }

        .header h1 {
            margin: 0;
            color: var(--brand-dark);
        }

        .header p {
            margin: 4px 0 0;
            font-size: .85rem;
            color: #6b7280;
        }

        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: .78rem;
            padding: 6px 12px;
            border-radius: 999px;
            background: #ecfeff;
            border: 1px solid #bae6fd;
        }

        .status-dot {
            width: 9px;
            height: 9px;
            border-radius: 50%;
            background: #9ca3af;
        }

        .status-dot.recording {
            background: #ef4444;
            box-shadow: 0 0 0 6px rgba(239, 68, 68, .25);
        }

        .patient-row {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1.5fr;
            gap: 30px;
            margin: 18px 0;
        }

        @media(max-width:700px) {
            .patient-row {
                grid-template-columns: 1fr;
            }
        }

        input,
        select {
            width: 100%;
            padding: 8px 12px;
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            font-size: .9rem;
        }

        .global-toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 14px;
        }

        button {
            border: none;
            border-radius: 999px;
            padding: 8px 14px;
            font-size: .9rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        button span.icon {
            font-size: 1.1rem;
        }

        button.primary {
            background: var(--brand-main);
            color: white;
            box-shadow: 0 8px 16px rgba(15, 118, 110, 0.25);
        }

        button.primary:hover {
            background: var(--brand-main-dark);
        }

        button.danger {
            background: #fee2e2;
            color: #b91c1c;
        }

        button.success {
            background: #dcfce7;
            color: #166534;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 12px rgba(15, 23, 42, 0.15);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 3px 7px rgba(15, 23, 42, 0.15);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .primary {
            background: var(--brand-main);
            color: #fff;
        }

        .danger {
            background: #fee2e2;
            color: #b91c1c;
        }

        .success {
            background: #dcfce7;
            color: #166534;
        }

        .sheet {
            display: grid;
            gap: 12px;
        }

        .section-card {
            border: 2px solid #000;
            border-radius: 10px;
            padding: 10px;
            font-family: "Times New Roman", serif;
        }

        .section-card.active {
            box-shadow: 0 0 0 3px rgba(14, 165, 233, .4);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #000;
            padding-bottom: 6px;
            margin-bottom: 6px;
        }

        .note-item {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 4px;
        }

        .note-actions {
            display: flex;
            gap: 6px;
        }

        .note-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: .95rem;
        }

        .note-item span[contenteditable="true"] {
            outline: 2px dashed #0ea5e9;
            border-radius: 4px;
            padding: 2px 4px;
        }

        /* Undo toast */
        #undoToast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #111827;
            color: white;
            padding: 10px 16px;
            border-radius: 999px;
            display: none;
            gap: 12px;
            align-items: center;
            font-size: .85rem;
            z-index: 1000;
        }

        #undoToast button {
            background: none;
            border: none;
            color: #38bdf8;
            font-weight: 600;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="app">

        <div class="header">
            <div>
                <h1>KeshavCare ‚Äì V53</h1>
                <p>Section-wise OPD dictation with audio feedback</p>
            </div>
            <div class="status-chip">
                <div id="statusDot" class="status-dot"></div>
                <span id="statusText">Mic is idle</span>
            </div>
        </div>

        <div class="patient-row">
            <input placeholder="Patient name">
            <input placeholder="Visit ID / MRN">
            <select id="languageSelect">
                <option value="en-IN">English</option>
                <option value="hi-IN">Hindi</option>
                <option value="te-IN">Telugu</option>
            </select>
        </div>

        <div class="global-toolbar">
            <button class="danger" onclick="clearAll()">üßπ Clear all</button>
            <button class="success" onclick="downloadText()">‚¨áÔ∏è Download Text</button>
        </div>

        <div class="sheet">
            <div class="section-card" data-section="complaints">
                <div class="section-header">
                    <h3>1. Complaints</h3>
                    <button class="primary section-mic" data-section="complaints">üéôÔ∏è Start Listening</button>
                </div>
                <ul id="complaints"></ul>
            </div>

            <div class="section-card" data-section="history">
                <div class="section-header">
                    <h3>2. History</h3>
                    <button class="primary section-mic" data-section="history">üéôÔ∏è Start Listening</button>
                </div>
                <ul id="history"></ul>
            </div>

            <div class="section-card" data-section="exam">
                <div class="section-header">
                    <h3>3. Examination</h3>
                    <button class="primary section-mic" data-section="exam">üéôÔ∏è Start Listening</button>
                </div>
                <ul id="exam"></ul>
            </div>

            <div class="section-card" data-section="investigations">
                <div class="section-header">
                    <h3>4. Investigations</h3>
                    <button class="primary section-mic" data-section="investigations">üéôÔ∏è Start Listening</button>
                </div>
                <ul id="investigations"></ul>
            </div>

            <div class="section-card" data-section="advice">
                <div class="section-header">
                    <h3>5. Advice</h3>
                    <button class="primary section-mic" data-section="advice">üéôÔ∏è Start Listening</button>
                </div>
                <ul id="advice"></ul>
            </div>

            <ul id="finalNotesList" hidden></ul>
        </div>
    </div>

    <div id="undoToast">
        Note deleted
        <button onclick="undoDelete()">Undo</button>
    </div>
    <!-- 
    <script>
        /* üîî BEEP */
        let audioCtx = null;
        function beep(f, d) {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.frequency.value = f; g.gain.value = 0.08;
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); setTimeout(() => o.stop(), d);
        }
        const beepStart = () => beep(880, 120);
        const beepStop = () => beep(440, 160);

        /* üéô SPEECH */
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.interimResults = false;
        recognition.continuous = false;

        let recognizing = false;
        let activeSection = null;
        let activeButton = null;
        let session = 0, activeSession = null;

        /* üóëÔ∏è UNDO */
        let lastDeleted = null, lastParent = null, undoTimer = null;

        recognition.onresult = e => {
            if (activeSession !== session || !activeSection) return;
            const r = e.results[e.results.length - 1];
            if (r.isFinal) addNote(r[0].transcript.trim());
        };

        recognition.onend = () => {
            // Auto-restart ONLY if user has not paused
            if (recognizing && activeSection) {
                try {
                    recognition.start();
                } catch (e) {
                    // iOS can throw if start() is too fast
                    setTimeout(() => {
                        try { recognition.start(); } catch { }
                    }, 300);
                }
            }
        };

        document.querySelectorAll(".section-mic").forEach(btn => {
            btn.onclick = () => {
                const sec = btn.dataset.section;
                recognizing && activeSection === sec ? stopRec() : startRec(sec, btn);
            };
        });

        function startRec(sec, btn) {
            try { recognition.abort(); } catch { }
            session++; activeSession = session;
            if (activeButton) activeButton.textContent = "üéô Start Listening";
            activeSection = sec; activeButton = btn;
            btn.textContent = "‚è∏ Pause Listening";
            highlight(sec); updateStatus(true); beepStart();
            recognition.lang = languageSelect.value;
            recognition.start(); recognizing = true;
        }

        function stopRec() {
            try { recognition.abort(); } catch { }
            recognizing = false; activeSection = null; activeSession = null;
            if (activeButton) { activeButton.textContent = "üéô Start Listening"; activeButton = null; }
            clearHighlight(); updateStatus(false); beepStop();
        }

        function updateStatus(on) {
            statusDot.classList.toggle("recording", on);
            statusText.textContent = on ? "Listening‚Ä¶" : "Mic is idle";
        }

        function highlight(sec) {
            document.querySelectorAll(".section-card").forEach(c => c.classList.remove("active"));
            document.querySelector(`[data-section="${sec}"]`).classList.add("active");
        }
        function clearHighlight() {
            document.querySelectorAll(".section-card").forEach(c => c.classList.remove("active"));
        }

        /* üìù NOTES */
        function addNote(text) {
            finalNotesList.appendChild(document.createElement("li")).textContent = text;
            const ul = document.getElementById(activeSection);
            if (!ul) return;

            const li = document.createElement("li");
            li.className = "note-item";

            const span = document.createElement("span");
            span.textContent = text;

            const actions = document.createElement("div");
            actions.className = "note-actions";

            const edit = document.createElement("button");
            edit.textContent = "‚úèÔ∏è";
            edit.onclick = () => {
                const old = span.textContent;
                span.contentEditable = true;
                span.focus();
                span.onkeydown = e => {
                    if (e.key === "Enter") { e.preventDefault(); span.contentEditable = false; }
                    if (e.key === "Escape") { span.textContent = old; span.contentEditable = false; }
                };
            };

            const del = document.createElement("button");
            del.textContent = "üóëÔ∏è";
            del.onclick = () => {
                if (!confirm("Delete this note?")) return;
                lastDeleted = li; lastParent = ul;
                ul.removeChild(li);
                showUndo();
            };

            actions.append(edit, del);
            li.append(span, actions);
            ul.appendChild(li);
        }

        /* ‚Ü©Ô∏è UNDO */
        function showUndo() {
            undoToast.style.display = "flex";
            clearTimeout(undoTimer);
            undoTimer = setTimeout(() => {
                undoToast.style.display = "none";
                lastDeleted = null; lastParent = null;
            }, 5000);
        }
        function undoDelete() {
            if (!lastDeleted) return;
            lastParent.appendChild(lastDeleted);
            lastDeleted = null; lastParent = null;
            undoToast.style.display = "none";
        }

        /* üìÑ HELPERS */
        function clearAll() {
            document.querySelectorAll(".sheet ul").forEach(u => u.innerHTML = "");
        }
        function downloadText() {
            let t = "";
            document.querySelectorAll(".section-card").forEach(c => {
                t += c.querySelector("h3").innerText + "\n";
                c.querySelectorAll("li span").forEach(s => t += "- " + s.innerText + "\n");
                t += "\n";
            });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(new Blob([t], { type: "text/plain" }));
            a.download = "OPD_Notes.txt";
            a.click();
        }
    </script> -->
    <script>
        /* üéô SPEECH */
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.interimResults = false;
        recognition.continuous = false;

        let recognizing = false;
        let activeSection = null;
        let activeButton = null;
        let session = 0, activeSession = null;

        /* üóëÔ∏è UNDO */
        let lastDeleted = null, lastParent = null, undoTimer = null;
    </script>

    <script src="Index/Js/entryFile.js" type="module"></script>
</body>

</html>